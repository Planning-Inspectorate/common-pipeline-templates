parameters:
  - name: keyVaultName
    type: string
    default: $(KEY_VAULT_NAME)
  - name: secrets
    type: object
    default: []

steps:
- ${{ each secret in parameters.secrets }}:
  - script: |
      SECRET_VALUE=$(az keyvault secret show -n ${{ secret }} --vault-name ${{ parameters.keyVaultName }} | jq -c -r '.value')
      echo "##vso[task.setvariable variable=${key};issecret=true]$SECRET_VALUE"
    displayName: Retrieve ${{ secret }} secret from Key Vault 
